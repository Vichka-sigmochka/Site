{% extends "base_for_home.html" %}

{% block content %}
    <main>
        <div class="row">
            {% for post in posts %}
                <div class="col-md-4 mb-4">
                <div class="card h-100">
                {% if post.image %}
                    <div class="card-img-container" style="height: 200px; overflow: hidden;">  <!-- Фиксированная высота контейнера -->
                        <img
                            src="{{ url_for('static', filename='uploads/' + post.image) }}"
                            class="card-img-top img-fluid"
                            alt="{{ post.title }}"
                            style="width: 100%; height: 100%; object-fit: cover;"
                        >
                    </div>
                {% endif %}
                <div class="card-body">
                    <h5 class="card-title">{{ post.title }}</h5>
                    <p class="card-text">{{ post.description[:100] }}{% if post.description|length > 100 %}...{% endif %}</p>
                </div>
                <div class="card-footer text-muted">
                Опубликовано: {{ post.date_created.strftime('%d.%m.%Y') }} | Автор: <a href="{{ url_for('profile_author_post', user_id=post.user_id) }}" style="display: inline;">{{ post.name }}</a>
                </div>
                <form action="{{ url_for('toggle_like', post_id=post.id) }}" method="POST" class="like-form">
    <button type="submit" class="like-btn {% if post.is_liked %}liked{% endif %}">
        ❤️ <span class="likes-count">{{ post.likes|length }}</span>
    </button>
</form>
            </div>
        </div>
        {% endfor %}
        </div>
    </main>
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.like-form').forEach(form => {
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            const button = this.querySelector('.like-btn');
            const counter = this.querySelector('.likes-count');

            try {
                const response = await fetch(this.action, {
                    method: 'POST',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'Accept': 'application/json'
                    },
                    body: new FormData(this)
                });

                const data = await response.json();

                if(data.status === 'success') {
                    counter.textContent = data.likes_count;
                    button.classList.toggle('liked', data.action === 'liked');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });
    });
});
</script>

    <style>
    .like-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.2rem;
    transition: all 0.3s;
    padding: 5px;
}

.like-btn.liked {
    color: red;
    transform: scale(1.1);
}

.like-btn:focus {
    outline: none;
}
    </style>
{% endblock %}